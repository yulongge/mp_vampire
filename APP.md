---

思考一个问题

--

我们如何在代码库基于某一框架的情况下，能以尽可能小的代价,在未来将组件库迁移到其他`框架/库` 下?

总不能基于新的技术全部重写一遍吧，这样太浪费生命了。

我们开发项目，交互/行为 逻辑基本上是可确定的，最多也就是 UI 上的一些调整。

在 MVVM 架构视角下，越是重型的应用其复杂度越是集中在 M(Model) 跟 VM(ViewModel) 这两层，尤其是 Model 层，理论上应该是能脱离上层视图独立运行独立发布独立测试的存在，而相应的不同视图框架只是使用了不同绑定语法的动态模板引擎而已，所以只要我们将视图层做的很薄，我们迁移的成本自然会降到一个可接受的范畴。

要做到 Model 甚至 ViewModel 独立可复用，我们需要的是一种可以帮助我们描述各数据模型间依赖关系图且框架`中立`的通用状态管理方案


> 首先我们选择的ui框架：vue。因为做小程序，多端实现，我们选择了uni-app，所以我们就要去调研和选择跟vue搭配的状态管理方案


在架构上，我们只需要使用对应的 connector，就能基于同一数据层，在不同框架下自如的切换

尝试：

vuex 太偏向vue
mobx 框架中立, 语法足够简单
redux 开发体验太差
xstate 

### Vuex

说实话，vuex跟uni-app搭配，确实很方便，思想流程上也很顺畅，结合`vuex-orm`做到model和状态的映射，确实让人向往。但是太偏向vue了，这样的model层，就会被vuex污染，如果将来迁移，vuex又不支持别的框架，我们就会泥潭深陷，很不舍的打算放弃

> 项目分支：dev 则是vuex实现的一版，当然control,model层都有，只是model层有些不理想

### Redux

> Mobx和Redux都是JavaScript应用状态管理库，都适用于React，Angular，VueJs等框架或库，而不是局限于某一特定UI库

redux: 曾经算是react应用管理库中的霸主，但是确实繁琐，流程较多，需要配置，创建store,编写reducer, action，涉及到异步，还需要引入redux-thunk中间件等，心里是拒绝的。暂时搁浅

### Mobx

自由，简单，中立，也许是这两年用的多，所以内心会偏向mobx,学习成本低，面向对象，当然了，规范性不如redux,也因人而异吧，每个的代码风格不一，我们也可以写的很规范。因为ui库的选择(vue),内心就泛起了纠结，怎么去写对应的connector链接起来，是个问题。

在公司过去的项目里，我们一直运用react/mobx搭配来构建项目，实践上也达到了了预期的效果.

然后就有了,自己水平有限，尝试写了一些connector,木有成功, so...

> 在github上搜到了mobx-vue

所以分支：`dev-mobx`里实现了一版，mobx状态管理的

### Xstate

XState是一个用于创建，解释和执行状态图的库

- 遵守W3C SCXML规范和David Harel的原始状态图形式主义
- 促进Actor模型基于事件的架构
- 与所有框架和平台的兼容性
- 能够将机器定义完全序列化为JSON（和SCXML）
- 纯功能Machine(...)API
- 零依赖

最终选择xstate

### Q&A

1. vuex版本，在uni-app框架下，各种编译平台都可以实用。唯一不足，未来迁移中model层，需要修改。

2. mobx版本， 在uni-app框架下，h5版本没问题，小程序平台下，还需要在修改兼容一下，
